trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  node_version: '16.x'  # Or any other version you prefer

steps:
# Step 1: Install Node.js (if UseNode@1 does not work)
- script: |
    curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -
    sudo apt-get install -y nodejs
  displayName: 'Install Node.js'

# Step 2: Checkout the repository
- checkout: self

# Step 3: Install backend and frontend dependencies
- script: |
    echo Installing backend dependencies...
    cd backend
    npm install

    echo Installing frontend dependencies...
    cd ../frontend
    npm install
  displayName: 'Install dependencies'

# Step 4: Build frontend
- script: |
    cd frontend
    npm run build
  displayName: 'Build frontend (Vue.js)'

# Step 5: Run backend tests (optional)
- script: |
    cd backend
    npm test
  displayName: 'Run backend tests'

# Step 6: Publish artifacts
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'drop'
    publishLocation: 'Container'